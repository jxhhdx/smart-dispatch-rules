# 日志管理测试用例

> Logs Module - 系统日志、登录日志、查询统计

---

## 模块概览

| 属性 | 值 |
|-----|---|
| 模块 | 日志管理 (logs) |
| 文件 | `apps/api/src/modules/logs/` |
| 核心功能 | 系统日志查询、登录日志查询、日志记录 |
| 测试用例数 | 28 |
| 优先级分布 | P0: 10, P1: 10, P2: 8 |

---

## 1. 功能路径测试 (Functional)

### 1.1 系统日志查询

| ID | 场景 | 输入 | 预期输出 | 优先级 |
|----|------|------|---------|--------|
| LOG-F-01 | 查询所有系统日志 | 无参数 | 返回分页日志列表 | P0 |
| LOG-F-02 | 按模块过滤 | module="user" | 返回用户模块日志 | P1 |
| LOG-F-03 | 按操作过滤 | action="create" | 返回创建操作日志 | P1 |
| LOG-F-04 | 按日期范围过滤 | startDate, endDate | 返回范围内日志 | P1 |
| LOG-F-05 | 组合过滤 | module+action+date | 返回匹配日志 | P1 |

### 1.2 登录日志查询

| ID | 场景 | 输入 | 预期输出 | 优先级 |
|----|------|------|---------|--------|
| LOG-F-10 | 查询所有登录日志 | 无参数 | 返回分页登录日志 | P0 |
| LOG-F-11 | 按用户名过滤 | username="admin" | 返回该用户日志 | P1 |
| LOG-F-12 | 按状态过滤 | status=1 (成功) | 返回成功登录日志 | P1 |
| LOG-F-13 | 按日期范围过滤 | startDate, endDate | 返回范围内日志 | P1 |
| LOG-F-14 | 模糊搜索用户名 | username="ad" | 返回匹配用户日志 | P1 |

### 1.3 日志创建

| ID | 场景 | 输入 | 预期输出 | 优先级 |
|----|------|------|---------|--------|
| LOG-F-20 | 创建系统日志 | 完整日志数据 | 日志记录成功 | P1 |
| LOG-F-21 | 创建登录日志 | 完整登录数据 | 日志记录成功 | P1 |
| LOG-F-22 | 创建日志-可选字段 | 部分字段 | 允许null字段 | P2 |

---

## 2. 边界值测试 (Boundary)

### 2.1 日期范围

| ID | 场景 | 输入值 | 预期结果 | 优先级 |
|----|------|-------|---------|--------|
| LOG-B-01 | 开始日期=结束日期 | 同一天 | 返回当天数据 | P1 |
| LOG-B-02 | 开始日期>结束日期 | 无效范围 | 返回空或400 | P1 |
| LOG-B-03 | 极早日期 | 1970-01-01 | 返回从最早开始 | P2 |
| LOG-B-04 | 未来日期 | 2099-12-31 | 返回空列表 | P2 |
| LOG-B-05 | 无效日期格式 | "not-a-date" | 400 格式错误 | P1 |

### 2.2 分页

| ID | 场景 | 输入值 | 预期结果 | 优先级 |
|----|------|-------|---------|--------|
| LOG-B-10 | 页码边界 | page=1 | 返回首页 | P0 |
| LOG-B-11 | 页大小边界 | pageSize=1 | 返回1条 | P0 |
| LOG-B-12 | 超大页大小 | pageSize=10000 | 截断到最大值 | P2 |

### 2.3 日志内容

| ID | 场景 | 输入值 | 预期结果 | 优先级 |
|----|------|-------|---------|--------|
| LOG-B-20 | 超长描述 | 5000字符 | 存储成功或截断 | P2 |
| LOG-B-21 | 超大参数JSON | >1MB | 截断或拒绝 | P2 |
| LOG-B-22 | 特殊字符 | emoji, 中文 | 正确存储 | P1 |

---

## 3. 异常测试 (Exception)

### 3.1 依赖异常

| ID | 场景 | 模拟条件 | 预期行为 | 优先级 |
|----|------|---------|---------|--------|
| LOG-E-01 | 数据库写入失败 | 磁盘满/连接失败 | 记录失败但不影响主流程 | P1 |
| LOG-E-02 | 日志表不存在 | 表被删除 | 错误处理 | P2 |

### 3.2 并发异常

| ID | 场景 | 测试方法 | 预期行为 | 优先级 |
|----|------|---------|---------|--------|
| LOG-E-10 | 高并发写日志 | 1000并发 | 所有日志正确记录 | P2 |
| LOG-E-11 | 读写并发 | 查询时写入 | 无数据损坏 | P2 |

---

## 4. 性能测试 (Performance)

| ID | 场景 | 测试条件 | 预期指标 | 优先级 |
|----|------|---------|---------|--------|
| LOG-P-01 | 列表查询 | 100万日志 | < 200ms | P1 |
| LOG-P-02 | 日期范围查询 | 有索引 | < 150ms | P1 |
| LOG-P-03 | 写入日志 | 异步写入 | 不阻塞主流程 | P1 |
| LOG-P-04 | 高并发写入 | 1000TPS | 无丢失 | P2 |

---

## 5. 安全测试 (Security)

| ID | 场景 | 测试输入 | 预期防护 | 优先级 |
|----|------|---------|---------|--------|
| LOG-S-01 | 日志注入攻击 | 参数含恶意代码 | 转义存储 | P1 |
| LOG-S-02 | 敏感信息泄露 | 密码在参数中 | 脱敏处理 | P1 |
| LOG-S-03 | 越权查看日志 | 普通用户查系统日志 | 403 权限检查 | P0 |
| LOG-S-04 | 日志篡改 | 尝试修改已有日志 | 不可修改（只读） | P1 |

---

## 6. 执行清单

### P0 必测项（10个）

- [ ] LOG-F-01 查询系统日志
- [ ] LOG-F-10 查询登录日志
- [ ] LOG-B-10~11 分页边界
- [ ] LOG-S-03 越权检查

---

*文档结束 - 日志管理共28个测试用例*
