# 端到端 (E2E) 测试用例

> E2E Tests - Playwright 端到端测试

---

## 测试概览

| 属性 | 值 |
|-----|---|
| 工具 | Playwright |
| 浏览器 | Chromium, Firefox, WebKit |
| 测试文件 | `e2e/tests/*.spec.ts` |
| 测试用例数 | 12 |
| 优先级分布 | P0: 8, P1: 4, P2: 0 |

---

## 1. 登录流程

| ID | 场景 | 步骤 | 预期结果 | 优先级 |
|----|------|------|---------|--------|
| E2E-01 | 完整登录流程 | 1. 访问登录页<br>2. 输入用户名密码<br>3. 点击登录 | 登录成功，进入首页 | P0 |
| E2E-02 | 登录失败流程 | 1. 访问登录页<br>2. 输入错误密码<br>3. 点击登录 | 显示错误提示 | P0 |
| E2E-03 | 登录后权限检查 | 登录后访问各页面 | 根据角色显示菜单 | P1 |

**测试代码示例:**
```typescript
// login.spec.ts
import { test, expect } from '@playwright/test'

test('E2E-01: complete login flow', async ({ page }) => {
  // 访问登录页
  await page.goto('/login')
  
  // 输入凭据
  await page.fill('[name="username"]', 'admin')
  await page.fill('[name="password"]', 'admin123')
  
  // 点击登录
  await page.click('button[type="submit"]')
  
  // 验证跳转
  await expect(page).toHaveURL('/')
  await expect(page.locator('.welcome-message')).toContainText('欢迎')
})

test('E2E-02: login failure', async ({ page }) => {
  await page.goto('/login')
  await page.fill('[name="username"]', 'admin')
  await page.fill('[name="password"]', 'wrongpassword')
  await page.click('button[type="submit"]')
  
  // 验证错误提示
  await expect(page.locator('.ant-message-error')).toBeVisible()
  await expect(page).toHaveURL('/login')  // 停留在登录页
})
```

---

## 2. 用户管理流程

| ID | 场景 | 步骤 | 预期结果 | 优先级 |
|----|------|------|---------|--------|
| E2E-10 | 创建用户完整流程 | 1. 进入用户页<br>2. 点击创建<br>3. 填写表单<br>4. 提交 | 用户创建成功，列表刷新 | P0 |
| E2E-11 | 编辑用户完整流程 | 1. 点击编辑<br>2. 修改信息<br>3. 提交 | 用户更新成功 | P0 |
| E2E-12 | 删除用户完整流程 | 1. 点击删除<br>2. 确认删除 | 用户删除成功 | P0 |
| E2E-13 | 用户搜索流程 | 输入关键词搜索 | 显示搜索结果 | P1 |

**测试代码:**
```typescript
// users.spec.ts
test('E2E-10: create user flow', async ({ page }) => {
  // 登录
  await login(page)
  
  // 进入用户管理
  await page.click('text=用户管理')
  await expect(page).toHaveURL('/users')
  
  // 点击创建
  await page.click('text=新建用户')
  
  // 填写表单
  await page.fill('[name="username"]', 'testuser')
  await page.fill('[name="email"]', 'test@example.com')
  await page.fill('[name="password"]', 'password123')
  
  // 提交
  await page.click('button:has-text("保存")')
  
  // 验证成功
  await expect(page.locator('.ant-message-success')).toBeVisible()
  await expect(page.locator('td:has-text("testuser")')).toBeVisible()
})
```

---

## 3. 角色管理流程

| ID | 场景 | 步骤 | 预期结果 | 优先级 |
|----|------|------|---------|--------|
| E2E-20 | 创建角色流程 | 创建角色+分配权限 | 角色创建成功 | P0 |
| E2E-21 | 权限分配流程 | 编辑角色权限 | 权限更新成功 | P0 |

---

## 4. 规则管理流程

| ID | 场景 | 步骤 | 预期结果 | 优先级 |
|----|------|------|---------|--------|
| E2E-30 | 创建规则流程 | 填写规则信息 | 规则创建成功 | P0 |
| E2E-31 | 规则版本流程 | 1. 创建规则<br>2. 创建版本<br>3. 发布版本 | 版本发布成功 | P0 |

---

## 5. 导航与国际化

| ID | 场景 | 步骤 | 预期结果 | 优先级 |
|----|------|------|---------|--------|
| E2E-40 | 页面导航 | 点击各菜单 | 正确跳转页面 | P1 |
| E2E-41 | 语言切换 | 切换中/英文 | 界面语言变化 | P1 |

---

## 6. 执行配置

### 6.1 Playwright 配置

```typescript
// playwright.config.ts
export default {
  testDir: './e2e/tests',
  use: {
    baseURL: 'http://localhost:3000',
    headless: true,
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
  },
  projects: [
    { name: 'chromium', use: { browserName: 'chromium' } },
    { name: 'firefox', use: { browserName: 'firefox' } },
    { name: 'webkit', use: { browserName: 'webkit' } },
  ],
}
```

### 6.2 测试辅助函数

```typescript
// e2e/utils/auth.ts
export async function login(page, username = 'admin', password = 'admin123') {
  await page.goto('/login')
  await page.fill('[name="username"]', username)
  await page.fill('[name="password"]', password)
  await page.click('button[type="submit"]')
  await page.waitForURL('/')
}

export async function logout(page) {
  await page.click('.user-menu')
  await page.click('text=退出登录')
  await page.waitForURL('/login')
}
```

---

## 7. 执行清单

### P0 必测项（8个）

- [ ] E2E-01 完整登录
- [ ] E2E-02 登录失败
- [ ] E2E-10 创建用户
- [ ] E2E-11 编辑用户
- [ ] E2E-12 删除用户
- [ ] E2E-20 创建角色
- [ ] E2E-30 创建规则
- [ ] E2E-31 规则版本

### 执行命令

```bash
# 运行所有 E2E 测试
npx playwright test

# 运行特定测试
npx playwright test login.spec.ts

#  headed 模式（显示浏览器）
npx playwright test --headed

# 生成报告
npx playwright show-report
```

---

*文档结束 - E2E测试共12个测试用例*
