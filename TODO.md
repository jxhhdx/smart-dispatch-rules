# Smart Dispatch Rules - 待办事项清单

> 📅 创建时间: 2026-02-08  
> 🎯 目标完成: 2026-02-28

---

## 🚨 高优先级（核心功能缺失）

### 1. Dashboard 统计模块 ❌
**现状**: 
- API 端 `apps/api/src/modules/dashboard/` 完全为空
- 前端 Dashboard 是硬编码的静态数据

**需要完成**:
- [ ] Dashboard API - 统计接口
  - 用户总数、规则总数、角色数
  - 今日派单统计数据
  - 规则触发次数统计
  - 图表数据接口（折线图、饼图）
- [ ] 前端 Dashboard 对接真实 API
- [ ] 添加图表库（如 Recharts 或 Ant Design Charts）

### 2. 规则可视化配置 ❌
**现状**: 
- 规则页面只有基础 CRUD
- 没有可视化条件编辑器

**需要完成**:
- [ ] 规则条件可视化编辑器
  - 拖拽式条件组合
  - 支持 AND/OR 逻辑
  - 字段、操作符、值的选择器
- [ ] 规则动作配置界面
  - 选择骑手
  - 设置优先级
  - 标记特殊处理

### 3. 规则模拟执行 ❌
**现状**: 无此功能

**需要完成**:
- [ ] 模拟执行 API
  - 输入测试订单数据
  - 运行规则引擎
  - 返回匹配的规则和结果
- [ ] 前端模拟执行界面
  - 表单输入测试数据
  - 显示执行结果
  - 显示匹配的规则链

### 4. 派单统计报表 ❌
**现状**: 
- 数据库有 `DispatchStatistic` 模型
- 但没有 API 和前端页面

**需要完成**:
- [ ] 统计报表 API
  - 按日期/小时统计
  - 派单成功率、准时率
  - 骑手负载统计
- [ ] 前端报表页面
  - 数据表格展示
  - 筛选条件（时间范围等）
  - 导出 Excel/PDF

---

## 🟡 中优先级（体验优化）

### 5. 缺失的设计文档 ❌
**现状**: README 提到但实际不存在

**需要完成**:
- [ ] `docs/design.md` - 架构设计、数据库设计、API 设计、前端设计
- [ ] `docs/i18n-design.md` - 多语言架构与实施方案
- [ ] `docs/API.md` - API 接口文档

### 6. 测试覆盖 ❌
**现状**: 无测试文件

**需要完成**:
- [ ] API 单元测试（Jest）
  - Auth 模块测试
  - User 模块测试
  - Rule 模块测试
- [ ] 前端组件测试（可选）

### 7. 性能优化 ❌
**需要完成**:
- [ ] API 响应缓存（Redis）
- [ ] 前端数据缓存
- [ ] 大数据量分页优化

---

## 🟢 低优先级（锦上添花）

### 8. 国际化完善
**现状**: 基础 i18n 已实现，但部分地方不完善

**需要完成**:
- [ ] Dashboard 统计卡片标题国际化
- [ ] 错误消息国际化
- [ ] 日语、韩语翻译完善（目前是占位符）

### 9. 代码质量
**需要完成**:
- [ ] ESLint 配置完善（目前 continue-on-error）
- [ ] 添加 Prettier 格式化检查
- [ ] 添加 Git Hooks（husky + lint-staged）

### 10. 部署验证
**需要完成**:
- [ ] Vercel 部署测试
- [ ] 环境变量配置验证
- [ ] GitHub Actions 部署流程验证

---

## 📊 当前完成度评估

| 模块 | 完成度 | 说明 |
|------|--------|------|
| 项目架构 | 90% | Turborepo + NestJS + React 搭建完成 |
| 数据库设计 | 95% | Prisma Schema 完整，包含统计表 |
| 认证授权 | 90% | JWT + RBAC 已完成 |
| 用户管理 | 90% | CRUD + 角色分配完成 |
| 角色权限 | 85% | 基础功能完成，缺少权限点细化 |
| 规则管理 | 60% | 基础 CRUD 完成，缺少可视化配置 |
| 操作日志 | 80% | 基础记录完成，可完善查询筛选 |
| Dashboard | 20% | 只有静态页面，无数据 |
| 统计报表 | 0% | 数据库有表，无 API 和页面 |
| 规则模拟 | 0% | 完全未开始 |
| 国际化 | 70% | 中英完成，日韩待完善 |
| 测试 | 0% | 无测试代码 |
| 文档 | 40% | README 完整，缺少设计文档 |

---

## 🎯 建议的开发顺序

### 第一阶段（2.8 - 2.14）
1. Dashboard 统计模块（前后端）
2. 派单统计报表（前后端）

### 第二阶段（2.15 - 2.21）
3. 规则可视化配置（前端编辑器）
4. 规则模拟执行（规则引擎实现）

### 第三阶段（2.22 - 2.28）
5. 测试覆盖
6. 完善文档
7. 部署验证

---

## 📝 备注

- 核心数据表已设计完整（包括 DispatchStatistic 统计表）
- GitHub Actions CI/CD 已配置
- 前端基础组件和布局已完成
- 主要工作集中在**规则引擎**和**数据统计**两大块
